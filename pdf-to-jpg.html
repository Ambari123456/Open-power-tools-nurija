<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script>
  async function convertPDF() {
    const fileInput = document.getElementById('pdfInput');
    const output = document.getElementById('output');
    output.innerHTML = '';

    if (!fileInput.files.length) {
      alert('Please upload a PDF file.');
      return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = async function () {
      const typedArray = new Uint8Array(this.result);
      const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;
      const page = await pdf.getPage(1);

      const scale = 1.5;
      const viewport = page.getViewport({ scale });
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      const renderContext = {
        canvasContext: context,
        viewport: viewport
      };

      await page.render(renderContext).promise;

      canvas.toBlob(function (blob) {
        if (blob) {
          const url = URL.createObjectURL(blob);

          // Preview
          const imgPreview = document.createElement('img');
          imgPreview.src = url;
          imgPreview.style.maxWidth = '100%';
          imgPreview.style.marginTop = '15px';
          output.appendChild(imgPreview);

          // Create download link
          const link = document.createElement('a');
          link.href = url;
          link.download = 'converted.jpg';

          // Auto-trigger download
          link.click();

          // Optional manual download link
          const manualLink = document.createElement('a');
          manualLink.href = url;
          manualLink.download = 'converted.jpg';
          manualLink.textContent = 'Download JPG manually';
          manualLink.style.display = 'block';
          manualLink.style.marginTop = '10px';
          manualLink.style.color = '#00aaff';
          output.appendChild(manualLink);

        } else {
          output.innerHTML = '<p>Conversion failed. Try a different file.</p>';
        }
      }, 'image/jpeg', 0.7);
    };

    reader.readAsArrayBuffer(file);
  }
</script>
